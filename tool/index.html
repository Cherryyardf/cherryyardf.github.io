<!-- Chosen Palette: "Bureaucratic Harmony" -->

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immobilien-Aktivierungs-Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        .phase-card { transition: all 0.3s ease; border-left: 4px solid transparent; }
        .phase-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .phase-card.active { border-left-color: #3b82f6; background-color: #ffffff; }

        .model-btn { transition: all 0.2s; }
        .model-btn.active { background-color: #0ea5e9; color: white; border-color: #0ea5e9; }

        .escalation-step { transition: all 0.3s; opacity: 0.5; }
        .escalation-step.active { opacity: 1; transform: scale(1.02); }

        .funnel-step {
            clip-path: polygon(0% 0%, 100% 0%, 95% 100%, 5% 100%);
            transition: all 0.5s ease;
        }
        
        /* Language Switcher inside Tool (optional fallback if iframe communication fails) */
        .tool-lang-switch { position: absolute; top: 10px; right: 10px; opacity: 0.5; z-index: 100; }
        .tool-lang-switch:hover { opacity: 1; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center relative">
            <div class="flex items-center gap-3">
                <span class="text-2xl">üèôÔ∏è</span>
                <div>
                    <h1 class="text-xl font-bold text-slate-800" data-i18n="tool_title">Immobilien-Aktivierung</h1>
                    <p class="text-xs text-slate-500 uppercase tracking-wide" data-i18n="tool_subtitle">Prozess-Management-Dashboard</p>
                </div>
            </div>
            <div class="hidden md:block">
                <span class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-800 text-sm font-medium" data-i18n="tool_goal">Ziel: Gemeinwohl & Aktivierung</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- Intro Section -->
        <section class="mb-8 text-center max-w-3xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-800 mb-4" data-i18n="intro_head">Der Weg zur Wiederbelebung</h2>
            <p class="text-slate-600 leading-relaxed" data-i18n="intro_text">
                Dieses interaktive Tool visualisiert den Prozess der Stadt zur Aktivierung leerstehender Immobilien.
                Von der ersten datenbasierten Analyse bis hin zur Entscheidung zwischen Kooperation ("Soft Power") 
                und hoheitlichem Eingriff ("Hard Power"). Nutzen Sie die Navigation unten, um die einzelnen Phasen zu erkunden.
            </p>
        </section>

        <!-- Navigation Tabs -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 mb-8 bg-slate-100 p-2 rounded-xl">
            <button onclick="switchTab('phaseA')" id="tab-phaseA" class="nav-tab px-4 py-3 rounded-lg text-sm font-semibold transition-colors bg-white shadow text-blue-600" data-i18n="tab_a">A. Analyse & Vorlauf</button>
            <button onclick="switchTab('phaseB')" id="tab-phaseB" class="nav-tab px-4 py-3 rounded-lg text-sm font-semibold text-slate-500 hover:bg-slate-200 transition-colors" data-i18n="tab_b">B. Kontakt & Weiche</button>
            <button onclick="switchTab('phaseC')" id="tab-phaseC" class="nav-tab px-4 py-3 rounded-lg text-sm font-semibold text-slate-500 hover:bg-slate-200 transition-colors" data-i18n="tab_c">C. Kooperation (Soft)</button>
            <button onclick="switchTab('phaseD')" id="tab-phaseD" class="nav-tab px-4 py-3 rounded-lg text-sm font-semibold text-slate-500 hover:bg-slate-200 transition-colors" data-i18n="tab_d">D. Konfrontation (Hard)</button>
        </div>

        <!-- CONTENT AREA -->
        
        <!-- PHASE A: ANALYSE -->
        <div id="phaseA" class="tab-content block animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-2" data-i18n="a_title">A. Vorlauf & Analyse: Das Objekt finden</h3>
                    <p class="text-slate-600 mb-6" data-i18n="a_desc">
                        Bevor ein Kontakt stattfindet, nutzt die Stadt Daten (Strom, Wasser, Kataster), um Leerstand zu identifizieren. 
                        Nicht jedes Objekt lohnt den Aufwand ‚Äì hier findet die erste Filterung statt.
                    </p>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h4 class="font-semibold text-slate-800 mb-4" data-i18n="a_filter_title">Der Daten-Filter</h4>
                        <div class="space-y-4">
                            <!-- Visual Funnel -->
                            <div class="flex flex-col items-center">
                                <div class="w-full bg-slate-200 p-3 text-center text-slate-600 rounded-t-lg" data-i18n="funnel_1">Gesamter Immobilienbestand</div>
                                <div class="w-[90%] bg-blue-100 p-3 text-center text-blue-800 mt-1 funnel-step" data-i18n="funnel_2">Phase 1: Datenerhebung (Strom/Wasser)</div>
                                <div class="w-[80%] bg-blue-200 p-3 text-center text-blue-900 mt-1 funnel-step" data-i18n="funnel_3">Verdachtsf√§lle Leerstand</div>
                                <div id="final-funnel" class="w-[60%] bg-slate-300 p-3 text-center text-slate-500 mt-1 rounded-b-lg transition-colors cursor-pointer hover:bg-emerald-100" onclick="simulateAnalysis()" data-i18n="funnel_click">
                                    Klicken zur Analyse
                                </div>
                            </div>
                            
                            <div id="analysis-result" class="hidden mt-4 p-4 bg-emerald-50 border border-emerald-200 rounded-lg">
                                <p class="font-bold text-emerald-800 flex items-center">
                                    <span class="text-xl mr-2">‚úÖ</span> <span data-i18n="pot_high">Potenzial: HOCH</span>
                                </p>
                                <p class="text-sm text-emerald-700 mt-1" data-i18n="pot_msg">Das Objekt qualifiziert sich f√ºr die aktive Ansprache. Weiter zu Phase B.</p>
                                <button onclick="switchTab('phaseB')" class="mt-3 px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 transition text-sm" data-i18n="btn_contact">Zur Kontaktaufnahme ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h4 class="font-semibold text-slate-800 mb-4 text-center" data-i18n="chart_title_a">Leerstandskataster Statistik (Beispiel)</h4>
                    <p class="text-sm text-slate-500 mb-4 text-center" data-i18n="chart_sub_a">Verteilung der analysierten Objekte nach Potenzial</p>
                    <div class="chart-container">
                        <canvas id="analysisChart"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-slate-400 text-center" data-i18n="chart_note">Datenbasis: Illustrative Verteilung</div>
                </div>
            </div>
        </div>

        <!-- PHASE B: KONTAKT -->
        <div id="phaseB" class="tab-content hidden animate-fade-in">
            <div class="max-w-4xl mx-auto">
                <h3 class="text-2xl font-bold text-slate-800 mb-2" data-i18n="b_title">B. Die Weichenstellung</h3>
                <p class="text-slate-600 mb-8" data-i18n="b_desc">
                    Der Eigent√ºmer erh√§lt Infomaterial und ein Beratungsangebot. Seine Reaktion bestimmt den weiteren Verlauf vollkommen.
                    Dies ist der kritischste Punkt im Prozess.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 relative">
                    <!-- Connector Line for Desktop -->
                    <div class="hidden md:block absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-white rounded-full border-4 border-slate-200 z-10 flex items-center justify-center font-bold text-slate-400">
                        ?
                    </div>

                    <!-- Cooperative Path Choice -->
                    <div onclick="choosePath('soft')" class="cursor-pointer group hover:ring-2 hover:ring-blue-400 bg-white p-8 rounded-2xl border border-slate-200 shadow-sm transition-all text-center">
                        <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl group-hover:scale-110 transition-transform">
                            ü§ù
                        </div>
                        <h4 class="text-xl font-bold text-slate-800 mb-2" data-i18n="choice_coop">Kooperationswille</h4>
                        <p class="text-slate-500 text-sm" data-i18n="choice_coop_desc">Der Eigent√ºmer reagiert, zeigt Interesse oder nimmt das Beratungsangebot an.</p>
                        <div class="mt-6 inline-block text-blue-600 font-semibold group-hover:underline" data-i18n="link_path_c">Weg C: Soft Power w√§hlen ‚Üí</div>
                    </div>

                    <!-- Confrontational Path Choice -->
                    <div onclick="choosePath('hard')" class="cursor-pointer group hover:ring-2 hover:ring-red-400 bg-white p-8 rounded-2xl border border-slate-200 shadow-sm transition-all text-center">
                        <div class="w-16 h-16 bg-red-50 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl group-hover:scale-110 transition-transform">
                            ‚õî
                        </div>
                        <h4 class="text-xl font-bold text-slate-800 mb-2" data-i18n="choice_block">Blockade / Keine Reaktion</h4>
                        <p class="text-slate-500 text-sm" data-i18n="choice_block_desc">Der Eigent√ºmer ignoriert Kontaktversuche oder lehnt jegliche Gespr√§che ab.</p>
                        <div class="mt-6 inline-block text-red-600 font-semibold group-hover:underline" data-i18n="link_path_d">Weg D: Hard Power w√§hlen ‚Üí</div>
                    </div>
                </div>

                <div id="path-message" class="mt-8 p-4 rounded-lg bg-slate-100 text-center text-slate-600 italic hidden" data-i18n="msg_select">
                    W√§hlen Sie eine Option oben, um fortzufahren.
                </div>
            </div>
        </div>

        <!-- PHASE C: KOOPERATIV -->
        <div id="phaseC" class="tab-content hidden animate-fade-in">
            <h3 class="text-2xl font-bold text-blue-600 mb-2" data-i18n="c_title">C. Der kooperative Weg (Soft Power)</h3>
            <p class="text-slate-600 mb-6" data-i18n="c_desc">
                Das Ziel ist die Aktivierung durch Unterst√ºtzung. Die Stadt bietet Vertr√§ge, Finanzierungshilfen und Vernetzung.
                Kernst√ºck ist der "Angebots-Pool" mit 5 Modellen f√ºr verschiedene Eigent√ºmer-Situationen.
            </p>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Left: Model Selector -->
                <div class="lg:col-span-5 space-y-3">
                    <h4 class="font-semibold text-slate-700 mb-2" data-i18n="pool_title">Angebots-Pool (W√§hlen Sie ein Modell)</h4>
                    
                    <!-- Models 0-4 are populated dynamically via JS to handle translation better, or we keep static structure and update text. Static structure is robust. -->
                    <button onclick="showModel(0)" class="model-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-slate-50 flex items-center gap-3 active">
                        <span class="text-xl">üí∞</span>
                        <div>
                            <div class="font-bold" data-i18n="m0_title">Verkauf / Pacht</div>
                            <div class="text-xs opacity-70" data-i18n="m0_sub">F√ºr Eigent√ºmer ohne Zeit</div>
                        </div>
                    </button>

                    <button onclick="showModel(1)" class="model-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-slate-50 flex items-center gap-3">
                        <span class="text-xl">üëµ</span>
                        <div>
                            <div class="font-bold" data-i18n="m1_title">Verrentung (Viager)</div>
                            <div class="text-xs opacity-70" data-i18n="m1_sub">F√ºr Senioren</div>
                        </div>
                    </button>

                    <button onclick="showModel(2)" class="model-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-slate-50 flex items-center gap-3">
                        <span class="text-xl">üõ†Ô∏è</span>
                        <div>
                            <div class="font-bold" data-i18n="m2_title">Mitwirkung</div>
                            <div class="text-xs opacity-70" data-i18n="m2_sub">F√ºr Gestalter</div>
                        </div>
                    </button>

                    <button onclick="showModel(3)" class="model-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-slate-50 flex items-center gap-3">
                        <span class="text-xl">üé≠</span>
                        <div>
                            <div class="font-bold" data-i18n="m3_title">Zwischennutzung</div>
                            <div class="text-xs opacity-70" data-i18n="m3_sub">Kurzfristiger Leerstand</div>
                        </div>
                    </button>

                    <button onclick="showModel(4)" class="model-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-slate-50 flex items-center gap-3">
                        <span class="text-xl">üèòÔ∏è</span>
                        <div>
                            <div class="font-bold" data-i18n="m4_title">Genossenschaft</div>
                            <div class="text-xs opacity-70" data-i18n="m4_sub">Gegen Spekulation</div>
                        </div>
                    </button>
                </div>

                <!-- Right: Details & Visuals -->
                <div class="lg:col-span-7 space-y-6">
                    <!-- Dynamic Detail Card -->
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 min-h-[180px]">
                        <div id="model-detail-content">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Radar Chart -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <h4 class="font-semibold text-slate-700 mb-2 text-center" data-i18n="radar_title">Modell-Eigenschaften im Vergleich</h4>
                        <div class="chart-container">
                            <canvas id="modelsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Risk Check Section -->
            <div class="mt-8 p-4 bg-amber-50 rounded-lg border border-amber-200">
                <h4 class="font-bold text-amber-800 mb-2" data-i18n="risk_title">‚ö†Ô∏è Schritt 3: Risiko-Check</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-amber-900">
                    <div class="flex items-start gap-2">
                        <span>üìâ</span> <span data-i18n="risk_1">Gefahr: Finanzieller Verlust bei Verkauf unter Wert.</span>
                    </div>
                    <div class="flex items-start gap-2">
                        <span>‚è≥</span> <span data-i18n="risk_2">Gefahr: Lange Kapitalbindung bei B√ºrgerprojekten.</span>
                    </div>
                    <div class="flex items-start gap-2">
                        <span>üõë</span> <span data-i18n="risk_3">Gefahr: Blockade durch √úberforderung ehrenamtlicher Gruppen.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- PHASE D: KONFRONTATIV -->
        <div id="phaseD" class="tab-content hidden animate-fade-in">
            <h3 class="text-2xl font-bold text-red-600 mb-2" data-i18n="d_title">D. Der konfrontative Weg (Hard Power)</h3>
            <p class="text-slate-600 mb-6" data-i18n="d_desc">
                Wenn Dialog scheitert, greifen hoheitliche Instrumente. Zuerst erfolgt eine strenge Pr√ºfung der Verh√§ltnism√§√üigkeit.
                Nur wenn diese gegeben ist, wird die Eskalationsleiter betreten.
            </p>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Pre-Check Logic -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h4 class="font-bold text-slate-800 mb-4 border-b pb-2" data-i18n="check_title">1. Vorpr√ºfung & Verh√§ltnism√§√üigkeit</h4>
                    <p class="text-sm text-slate-500 mb-4" data-i18n="check_desc">Bevor eskaliert wird, muss rechtlich (Zweckentfremdung?) und finanziell (Sanierungskosten?) gepr√ºft werden.</p>
                    
                    <div class="bg-slate-50 p-4 rounded-lg mb-4">
                        <label class="flex items-center justify-between cursor-pointer mb-2">
                            <span class="font-semibold text-slate-700" data-i18n="check_q1">Zweckentfremdung nachweisbar?</span>
                            <input type="checkbox" id="check-legal" class="w-5 h-5 accent-red-600" onchange="checkProportionality()">
                        </label>
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="font-semibold text-slate-700" data-i18n="check_q2">Sanierung wirtschaftlich zumutbar?</span>
                            <input type="checkbox" id="check-financial" class="w-5 h-5 accent-red-600" onchange="checkProportionality()">
                        </label>
                    </div>

                    <div id="prop-result" class="p-3 rounded font-bold text-center bg-slate-200 text-slate-500 transition-colors" data-i18n="check_res_wait">
                        Pr√ºfung l√§uft...
                    </div>
                    
                    <div id="back-to-coop" class="hidden mt-4 text-center">
                        <p class="text-sm text-slate-600 mb-2" data-i18n="check_fail">Eingriff rechtlich zu heikel.</p>
                        <button onclick="switchTab('phaseC')" class="px-4 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm font-semibold" data-i18n="btn_back">
                            ‚Ü© Zur√ºck zum Verhandlungsangebot
                        </button>
                    </div>
                </div>

                <!-- Escalation Ladder -->
                <div id="escalation-container" class="bg-red-50 p-6 rounded-xl border border-red-100 opacity-50 pointer-events-none transition-opacity">
                    <h4 class="font-bold text-red-800 mb-4" data-i18n="esc_title">2. Phase 3: Die Eskalationsleiter</h4>
                    <p class="text-xs text-red-600 mb-4" data-i18n="esc_hint">Klicken Sie auf eine Stufe, um die Ma√ünahme zu aktivieren.</p>

                    <div class="space-y-3 relative">
                        <!-- Line -->
                        <div class="absolute left-6 top-4 bottom-4 w-1 bg-red-200 z-0"></div>

                        <!-- Steps -->
                        <div onclick="setEscalation(1)" class="escalation-step relative z-10 flex items-center bg-white p-3 rounded shadow-sm cursor-pointer border-l-4 border-red-300 hover:border-red-500">
                            <div class="w-8 h-8 rounded-full bg-red-100 text-red-600 flex items-center justify-center font-bold mr-3">1</div>
                            <div>
                                <div class="font-bold text-slate-800" data-i18n="step_1">Steuerdruck</div>
                                <div class="text-xs text-slate-500" data-i18n="step_1_d">Grundsteuer C f√ºr baureife Grundst√ºcke</div>
                            </div>
                        </div>

                        <div onclick="setEscalation(2)" class="escalation-step relative z-10 flex items-center bg-white p-3 rounded shadow-sm cursor-pointer border-l-4 border-red-400 hover:border-red-600">
                            <div class="w-8 h-8 rounded-full bg-red-200 text-red-700 flex items-center justify-center font-bold mr-3">2</div>
                            <div>
                                <div class="font-bold text-slate-800" data-i18n="step_2">Sanktion</div>
                                <div class="text-xs text-slate-500" data-i18n="step_2_d">Geldbu√üen und Baugebot</div>
                            </div>
                        </div>

                        <div onclick="setEscalation(3)" class="escalation-step relative z-10 flex items-center bg-white p-3 rounded shadow-sm cursor-pointer border-l-4 border-red-500 hover:border-red-700">
                            <div class="w-8 h-8 rounded-full bg-red-300 text-red-800 flex items-center justify-center font-bold mr-3">3</div>
                            <div>
                                <div class="font-bold text-slate-800" data-i18n="step_3">Eingriff</div>
                                <div class="text-xs text-slate-500" data-i18n="step_3_d">Enteignung auf Zeit / Treuh√§nder</div>
                            </div>
                        </div>

                        <div onclick="setEscalation(4)" class="escalation-step relative z-10 flex items-center bg-white p-3 rounded shadow-sm cursor-pointer border-l-4 border-red-600 hover:border-red-900">
                            <div class="w-8 h-8 rounded-full bg-red-600 text-white flex items-center justify-center font-bold mr-3">4</div>
                            <div>
                                <div class="font-bold text-slate-800" data-i18n="step_4">Ultima Ratio</div>
                                <div class="text-xs text-slate-500" data-i18n="step_4_d">Endg√ºltige Enteignung</div>
                            </div>
                        </div>
                    </div>

                    <div id="escalation-outcome" class="mt-4 p-3 bg-white rounded border border-red-200 text-center hidden">
                        <!-- Dynamic text -->
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-slate-800 text-slate-300 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="font-semibold" data-i18n="footer_goal">Ziel: Aktivierung der Eigentumspotenziale und Sicherung der Gemeinwohlziele.</p>
            <p class="text-xs text-slate-500 mt-2" data-i18n="footer_ref">Basierend auf dem Prozessdiagramm: Immobilienaktivierung</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- TRANSLATIONS ---
        const translations = {
            "de": {
                "tool_title": "Immobilien-Aktivierung", "tool_subtitle": "Prozess-Management-Dashboard", "tool_goal": "Ziel: Gemeinwohl & Aktivierung",
                "intro_head": "Der Weg zur Wiederbelebung", "intro_text": "Dieses interaktive Tool visualisiert den Prozess der Stadt zur Aktivierung leerstehender Immobilien. Von der ersten datenbasierten Analyse bis hin zur Entscheidung zwischen Kooperation ('Soft Power') und hoheitlichem Eingriff ('Hard Power').",
                "tab_a": "A. Analyse & Vorlauf", "tab_b": "B. Kontakt & Weiche", "tab_c": "C. Kooperation (Soft)", "tab_d": "D. Konfrontation (Hard)",
                "a_title": "A. Vorlauf & Analyse: Das Objekt finden", "a_desc": "Bevor ein Kontakt stattfindet, nutzt die Stadt Daten (Strom, Wasser, Kataster), um Leerstand zu identifizieren. Nicht jedes Objekt lohnt den Aufwand ‚Äì hier findet die erste Filterung statt.", "a_filter_title": "Der Daten-Filter", "funnel_1": "Gesamter Immobilienbestand", "funnel_2": "Phase 1: Datenerhebung (Strom/Wasser)", "funnel_3": "Verdachtsf√§lle Leerstand", "funnel_click": "Klicken zur Analyse", "pot_high": "Potenzial: HOCH", "pot_msg": "Das Objekt qualifiziert sich f√ºr die aktive Ansprache. Weiter zu Phase B.", "btn_contact": "Zur Kontaktaufnahme ‚Üí", "chart_title_a": "Leerstandskataster Statistik (Beispiel)", "chart_sub_a": "Verteilung der analysierten Objekte nach Potenzial", "chart_note": "Datenbasis: Illustrative Verteilung",
                "b_title": "B. Die Weichenstellung", "b_desc": "Der Eigent√ºmer erh√§lt Infomaterial und ein Beratungsangebot. Seine Reaktion bestimmt den weiteren Verlauf vollkommen. Dies ist der kritischste Punkt im Prozess.", "choice_coop": "Kooperationswille", "choice_coop_desc": "Der Eigent√ºmer reagiert, zeigt Interesse oder nimmt das Beratungsangebot an.", "link_path_c": "Weg C: Soft Power w√§hlen ‚Üí", "choice_block": "Blockade / Keine Reaktion", "choice_block_desc": "Der Eigent√ºmer ignoriert Kontaktversuche oder lehnt jegliche Gespr√§che ab.", "link_path_d": "Weg D: Hard Power w√§hlen ‚Üí", "msg_select": "W√§hlen Sie eine Option oben, um fortzufahren.",
                "c_title": "C. Der kooperative Weg (Soft Power)", "c_desc": "Das Ziel ist die Aktivierung durch Unterst√ºtzung. Die Stadt bietet Vertr√§ge, Finanzierungshilfen und Vernetzung. Kernst√ºck ist der 'Angebots-Pool' mit 5 Modellen f√ºr verschiedene Eigent√ºmer-Situationen.", "pool_title": "Angebots-Pool (W√§hlen Sie ein Modell)", "m0_title": "Verkauf / Pacht", "m0_sub": "F√ºr Eigent√ºmer ohne Zeit", "m1_title": "Verrentung (Viager)", "m1_sub": "F√ºr Senioren", "m2_title": "Mitwirkung", "m2_sub": "F√ºr Gestalter", "m3_title": "Zwischennutzung", "m3_sub": "Kurzfristiger Leerstand", "m4_title": "Genossenschaft", "m4_sub": "Gegen Spekulation", "radar_title": "Modell-Eigenschaften im Vergleich", "risk_title": "‚ö†Ô∏è Schritt 3: Risiko-Check", "risk_1": "Gefahr: Finanzieller Verlust bei Verkauf unter Wert.", "risk_2": "Gefahr: Lange Kapitalbindung bei B√ºrgerprojekten.", "risk_3": "Gefahr: Blockade durch √úberforderung ehrenamtlicher Gruppen.",
                "d_title": "D. Der konfrontative Weg (Hard Power)", "d_desc": "Wenn Dialog scheitert, greifen hoheitliche Instrumente. Zuerst erfolgt eine strenge Pr√ºfung der Verh√§ltnism√§√üigkeit. Nur wenn diese gegeben ist, wird die Eskalationsleiter betreten.", "check_title": "1. Vorpr√ºfung & Verh√§ltnism√§√üigkeit", "check_desc": "Bevor eskaliert wird, muss rechtlich (Zweckentfremdung?) und finanziell (Sanierungskosten?) gepr√ºft werden.", "check_q1": "Zweckentfremdung nachweisbar?", "check_q2": "Sanierung wirtschaftlich zumutbar?", "check_res_wait": "Pr√ºfung l√§uft...", "check_fail": "Eingriff rechtlich zu heikel.", "btn_back": "‚Ü© Zur√ºck zum Verhandlungsangebot", "esc_title": "2. Phase 3: Die Eskalationsleiter", "esc_hint": "Klicken Sie auf eine Stufe, um die Ma√ünahme zu aktivieren.", "step_1": "Steuerdruck", "step_1_d": "Grundsteuer C f√ºr baureife Grundst√ºcke", "step_2": "Sanktion", "step_2_d": "Geldbu√üen und Baugebot", "step_3": "Eingriff", "step_3_d": "Enteignung auf Zeit / Treuh√§nder", "step_4": "Ultima Ratio", "step_4_d": "Endg√ºltige Enteignung",
                "footer_goal": "Ziel: Aktivierung der Eigentumspotenziale und Sicherung der Gemeinwohlziele.", "footer_ref": "Basierend auf dem Prozessdiagramm: Immobilienaktivierung",
                "outcome_low": "<strong>Reaktion wahrscheinlich:</strong> Eigent√ºmer gibt nach. <br><span class='text-blue-600 cursor-pointer underline' onclick='switchTab(\"phaseC\")'>Wechsel in den kooperativen Pfad (C)</span>",
                "outcome_high": "<strong>Szenario 2 (Scheitern):</strong> Rechtsstreit, Blockade, dauerhafter Missstand. <br>Enteignung ist langwierig und teuer.",
                "outcome_mid": "<strong>Druck erh√∂ht:</strong> Eigent√ºmer unter Zugzwang. Einlenken m√∂glich.",
                "res_ok": "‚ö†Ô∏è Verh√§ltnism√§√üigkeit JA: Eskalation zul√§ssig", "res_no": "Verh√§ltnism√§√üigkeit NEIN: Eingriff nicht zul√§ssig"
            },
            "en": {
                "tool_title": "Real Estate Activation", "tool_subtitle": "Process Management Dashboard", "tool_goal": "Goal: Public Welfare & Activation",
                "intro_head": "The Path to Revitalization", "intro_text": "This interactive tool visualizes the city's process for activating vacant properties. From initial data-based analysis to the decision between cooperation ('Soft Power') and sovereign intervention ('Hard Power').",
                "tab_a": "A. Analysis & Prelim", "tab_b": "B. Contact & Switch", "tab_c": "C. Cooperation (Soft)", "tab_d": "D. Confrontation (Hard)",
                "a_title": "A. Prelim & Analysis: Finding the Object", "a_desc": "Before contact occurs, the city uses data (electricity, water, cadaster) to identify vacancies. Not every object is worth the effort ‚Äì this is the first filter.", "a_filter_title": "The Data Filter", "funnel_1": "Total Real Estate Stock", "funnel_2": "Phase 1: Data Collection (Util/Water)", "funnel_3": "Suspected Vacancies", "funnel_click": "Click to Analyze", "pot_high": "Potential: HIGH", "pot_msg": "The object qualifies for active approach. Proceed to Phase B.", "btn_contact": "Go to Contact ‚Üí", "chart_title_a": "Vacancy Statistics (Example)", "chart_sub_a": "Distribution of analyzed objects by potential", "chart_note": "Data basis: Illustrative distribution",
                "b_title": "B. The Switch", "b_desc": "The owner receives information and a consulting offer. Their reaction completely determines the further course. This is the most critical point in the process.", "choice_coop": "Willingness to Cooperate", "choice_coop_desc": "The owner reacts, shows interest, or accepts the consulting offer.", "link_path_c": "Choose Path C: Soft Power ‚Üí", "choice_block": "Blockade / No Reaction", "choice_block_desc": "The owner ignores contact attempts or refuses any talks.", "link_path_d": "Choose Path D: Hard Power ‚Üí", "msg_select": "Select an option above to proceed.",
                "c_title": "C. The Cooperative Way (Soft Power)", "c_desc": "The goal is activation through support. The city offers contracts, financing aid, and networking. The core is the 'Offer Pool' with 5 models for different owner situations.", "pool_title": "Offer Pool (Select a Model)", "m0_title": "Sale / Lease", "m0_sub": "For owners without time", "m1_title": "Life Annuity (Viager)", "m1_sub": "For seniors", "m2_title": "Participation", "m2_sub": "For creators", "m3_title": "Interim Use", "m3_sub": "Short-term vacancy", "m4_title": "Cooperative", "m4_sub": "Against speculation", "radar_title": "Model Characteristics Comparison", "risk_title": "‚ö†Ô∏è Step 3: Risk Check", "risk_1": "Danger: Financial loss if sold below value.", "risk_2": "Danger: Long capital commitment for citizen projects.", "risk_3": "Danger: Blockade due to excessive demands on volunteer groups.",
                "d_title": "D. The Confrontational Way (Hard Power)", "d_desc": "If dialogue fails, sovereign instruments apply. First, a strict proportionality check is carried out. Only if this is given, the escalation ladder is entered.", "check_title": "1. Pre-Check & Proportionality", "check_desc": "Before escalating, legal (misappropriation?) and financial (renovation costs?) aspects must be checked.", "check_q1": "Misappropriation provable?", "check_q2": "Renovation economically reasonable?", "check_res_wait": "Checking...", "check_fail": "Intervention legally too risky.", "btn_back": "‚Ü© Back to Negotiation Offer", "esc_title": "2. Phase 3: The Escalation Ladder", "esc_hint": "Click on a step to activate the measure.", "step_1": "Tax Pressure", "step_1_d": "Land Tax C for buildable plots", "step_2": "Sanction", "step_2_d": "Fines and building orders", "step_3": "Intervention", "step_3_d": "Temporary expropriation / Trustee", "step_4": "Ultima Ratio", "step_4_d": "Final Expropriation",
                "footer_goal": "Goal: Activation of property potentials and securing public welfare goals.", "footer_ref": "Based on the process diagram: Real Estate Activation",
                "outcome_low": "<strong>Reaction probable:</strong> Owner gives in. <br><span class='text-blue-600 cursor-pointer underline' onclick='switchTab(\"phaseC\")'>Switch to Cooperative Path (C)</span>",
                "outcome_high": "<strong>Scenario 2 (Failure):</strong> Legal dispute, blockade, permanent grievance. <br>Expropriation is tedious and expensive.",
                "outcome_mid": "<strong>Pressure increased:</strong> Owner under pressure. Giving in possible.",
                "res_ok": "‚ö†Ô∏è Proportionality YES: Escalation permissible", "res_no": "Proportionality NO: Intervention not permissible"
            },
            "fr": {
                "tool_title": "Activation Immobili√®re", "tool_subtitle": "Tableau de Bord de Gestion", "tool_goal": "Objectif : Bien commun & Activation",
                "intro_head": "Le chemin vers la revitalisation", "intro_text": "Cet outil interactif visualise le processus de la ville pour activer les biens vacants. De l'analyse initiale des donn√©es √† la d√©cision entre coop√©ration ('Soft Power') et intervention souveraine ('Hard Power').",
                "tab_a": "A. Analyse & Pr√©lim", "tab_b": "B. Contact & Aiguillage", "tab_c": "C. Coop√©ration (Soft)", "tab_d": "D. Confrontation (Hard)",
                "a_title": "A. Pr√©lim & Analyse : Trouver l'objet", "a_desc": "Avant tout contact, la ville utilise des donn√©es (√©lectricit√©, eau, cadastre) pour identifier la vacance. Chaque objet ne vaut pas l'effort ‚Äì c'est le premier filtre.", "a_filter_title": "Le Filtre de Donn√©es", "funnel_1": "Parc immobilier total", "funnel_2": "Phase 1 : Collecte de donn√©es (√âlec/Eau)", "funnel_3": "Cas suspects de vacance", "funnel_click": "Cliquez pour analyser", "pot_high": "Potentiel : √âLEV√â", "pot_msg": "L'objet se qualifie pour une approche active. Continuer vers Phase B.", "btn_contact": "Vers la prise de contact ‚Üí", "chart_title_a": "Statistiques Vacance (Exemple)", "chart_sub_a": "R√©partition des objets analys√©s par potentiel", "chart_note": "Base de donn√©es : R√©partition illustrative",
                "b_title": "B. L'Aiguillage", "b_desc": "Le propri√©taire re√ßoit des infos et une offre de conseil. Sa r√©action d√©termine la suite. C'est le point le plus critique du processus.", "choice_coop": "Volont√© de coop√©rer", "choice_coop_desc": "Le propri√©taire r√©agit, montre de l'int√©r√™t ou accepte l'offre.", "link_path_c": "Choisir Voie C : Soft Power ‚Üí", "choice_block": "Blocage / Pas de r√©action", "choice_block_desc": "Le propri√©taire ignore les tentatives ou refuse tout dialogue.", "link_path_d": "Choisir Voie D : Hard Power ‚Üí", "msg_select": "Choisissez une option ci-dessus pour continuer.",
                "c_title": "C. La voie coop√©rative (Soft Power)", "c_desc": "L'objectif est l'activation par le soutien. La ville offre contrats, aides financi√®res et mise en r√©seau. Le c≈ìur est le 'Pool d'Offres' avec 5 mod√®les.", "pool_title": "Pool d'Offres (Choisir un mod√®le)", "m0_title": "Vente / Bail", "m0_sub": "Pour propri√©taires sans temps", "m1_title": "Viager", "m1_sub": "Pour seniors", "m2_title": "Participation", "m2_sub": "Pour cr√©ateurs", "m3_title": "Usage interm√©diaire", "m3_sub": "Vacance courte dur√©e", "m4_title": "Coop√©rative", "m4_sub": "Contre la sp√©culation", "radar_title": "Comparaison des caract√©ristiques", "risk_title": "‚ö†Ô∏è √âtape 3 : V√©rification des risques", "risk_1": "Danger : Perte financi√®re si vente sous valeur.", "risk_2": "Danger : Longue immobilisation du capital.", "risk_3": "Danger : Blocage par surcharge des b√©n√©voles.",
                "d_title": "D. La voie conflictuelle (Hard Power)", "d_desc": "Si le dialogue √©choue, les instruments souverains s'appliquent. D'abord un contr√¥le strict de proportionnalit√©. Seulement si ok, l'√©chelle d'escalade est entam√©e.", "check_title": "1. Pr√©-contr√¥le & Proportionnalit√©", "check_desc": "Avant d'escalader, les aspects juridiques (d√©tournement ?) et financiers (co√ªt r√©novation ?) sont v√©rifi√©s.", "check_q1": "D√©tournement prouvable ?", "check_q2": "R√©novation √©conomiquement raisonnable ?", "check_res_wait": "V√©rification...", "check_fail": "Intervention juridiquement trop risqu√©e.", "btn_back": "‚Ü© Retour √† l'offre de n√©gociation", "esc_title": "2. Phase 3 : L'√©chelle d'escalade", "esc_hint": "Cliquez sur une √©tape pour activer la mesure.", "step_1": "Pression fiscale", "step_1_d": "Taxe fonci√®re C pour terrains constructibles", "step_2": "Sanction", "step_2_d": "Amendes et ordre de construire", "step_3": "Intervention", "step_3_d": "Expropriation temporaire / Fiduciaire", "step_4": "Ultima Ratio", "step_4_d": "Expropriation finale",
                "footer_goal": "Objectif : Activation des potentiels immobiliers et garantie du bien commun.", "footer_ref": "Bas√© sur le diagramme de processus : Activation Immobili√®re",
                "outcome_low": "<strong>R√©action probable :</strong> Le propri√©taire c√®de. <br><span class='text-blue-600 cursor-pointer underline' onclick='switchTab(\"phaseC\")'>Passer √† la voie coop√©rative (C)</span>",
                "outcome_high": "<strong>Sc√©nario 2 (√âchec) :</strong> Litige, blocage, grief permanent. <br>L'expropriation est longue et co√ªteuse.",
                "outcome_mid": "<strong>Pression augment√©e :</strong> Propri√©taire sous pression. Cession possible.",
                "res_ok": "‚ö†Ô∏è Proportionnalit√© OUI : Escalade admissible", "res_no": "Proportionnalit√© NON : Intervention non admissible"
            }
        };

        // --- GLOBAL LANG STATE ---
        let currentLang = 'de';

        function updateTexts(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if(translations[lang][key]) {
                    el.innerHTML = translations[lang][key]; // innerHTML allows <br> and <strong>
                }
            });
            // Re-render chart to update tooltips if needed (not implemented here for simplicity)
        }

        // Listen for messages from parent
        window.addEventListener('message', function(e) {
            if(e.data && e.data.type === 'changeLanguage') {
                updateTexts(e.data.lang);
            }
        });

        // Check LocalStorage on init (if run standalone)
        window.addEventListener('load', () => {
            const savedLang = localStorage.getItem('baukompass_lang');
            if(savedLang) updateTexts(savedLang);
            initAnalysisChart();
            sendHeight(); // Resize iframe
        });

        // --- DATA & STATE ---
        const models = [
            {
                // Titles and descs are now handled via i18n keys in the showModel function to support dynamic language switching
                id: 0,
                icon: "üí∞",
                stats: [90, 20, 10, 10] 
            },
            {
                id: 1,
                icon: "üëµ",
                stats: [60, 80, 50, 40]
            },
            {
                id: 2,
                icon: "üõ†Ô∏è",
                stats: [40, 40, 80, 60]
            },
            {
                id: 3,
                icon: "üé≠",
                stats: [100, 70, 60, 90]
            },
            {
                id: 4,
                icon: "üèòÔ∏è",
                stats: [30, 50, 90, 50]
            }
        ];

        let analysisChartInstance = null;
        let modelsChartInstance = null;

        // --- NAVIGATION ---
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(el => {
                el.classList.remove('bg-white', 'shadow', 'text-blue-600');
                el.classList.add('text-slate-500');
            });

            // Show selected
            document.getElementById(tabId).classList.remove('hidden');
            const activeBtn = document.getElementById('tab-' + tabId);
            activeBtn.classList.add('bg-white', 'shadow', 'text-blue-600');
            activeBtn.classList.remove('text-slate-500');

            // Init charts if needed
            if (tabId === 'phaseA' && !analysisChartInstance) initAnalysisChart();
            if (tabId === 'phaseC' && !modelsChartInstance) {
                setTimeout(() => { // slight delay for layout
                    initModelsChart();
                    showModel(0);
                }, 100);
            }
            sendHeight();
        }

        // --- PHASE A LOGIC ---
        function initAnalysisChart() {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            if(analysisChartInstance) analysisChartInstance.destroy();
            analysisChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Geringes Potenzial', 'Hohes Potenzial'], // Could also be translated
                    datasets: [{
                        data: [65, 35],
                        backgroundColor: ['#cbd5e1', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function simulateAnalysis() {
            const funnel = document.getElementById('final-funnel');
            const result = document.getElementById('analysis-result');
            
            // Translations for dynamic JS text
            const txt_analyzing = currentLang === 'de' ? "Analysiere..." : (currentLang === 'fr' ? "Analyse..." : "Analyzing...");
            const txt_identified = currentLang === 'de' ? "Objekt Identifiziert!" : (currentLang === 'fr' ? "Objet Identifi√© !" : "Object Identified!");

            funnel.innerText = txt_analyzing;
            funnel.classList.add('animate-pulse');
            
            setTimeout(() => {
                funnel.classList.remove('animate-pulse');
                funnel.classList.add('bg-emerald-500', 'text-white');
                funnel.innerText = txt_identified;
                result.classList.remove('hidden');
                sendHeight();
            }, 800);
        }

        // --- PHASE B LOGIC ---
        function choosePath(type) {
            if (type === 'soft') {
                switchTab('phaseC');
            } else {
                switchTab('phaseD');
            }
        }

        // --- PHASE C LOGIC ---
        function initModelsChart() {
            const ctx = document.getElementById('modelsChart').getContext('2d');
            if(modelsChartInstance) modelsChartInstance.destroy();
            modelsChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Speed', 'Sicherheit', 'Kontrolle', 'Effizienz'], // Should ideally be dynamic
                    datasets: [{
                        label: 'Profil',
                        data: [0,0,0,0],
                        backgroundColor: 'rgba(14, 165, 233, 0.2)',
                        borderColor: '#0ea5e9',
                        pointBackgroundColor: '#0ea5e9'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function showModel(index) {
            const m = models[index];
            const lang = currentLang; // Get current global lang
            
            // Update UI Cards
            document.querySelectorAll('.model-btn').forEach((btn, i) => {
                if(i === index) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            // Get translated strings
            const t = translations[lang];
            const title = t[`m${index}_title`];
            const sub = t[`m${index}_sub`];
            // Desc we keep hardcoded in Array or add to translation object (omitted for brevity, using defaults)
            const descMap = [
                {de: "Vollst√§ndige Abgabe der Verantwortung gegen fairen finanziellen Gegenwert.", en: "Complete handover of responsibility for fair financial value.", fr: "Transfert complet de responsabilit√© contre une juste valeur financi√®re."},
                {de: "Verkauf an die Stadt gegen eine lebenslange Rente und gesichertes Wohnrecht.", en: "Sale to the city for a life annuity and secured right of residence.", fr: "Vente √† la ville contre une rente viag√®re et un droit d'habitation garanti."},
                {de: "Verpachtung mit vertraglich gesichertem Mitspracherecht bei der Projektentwicklung.", en: "Lease with contractually secured say in project development.", fr: "Bail avec droit de regard contractuel sur le d√©veloppement du projet."},
                {de: "Nutzung durch Start-ups oder Kultur unter st√§dtischer Garantie zur √úberbr√ºckung.", en: "Use by start-ups or culture under municipal guarantee for bridging.", fr: "Utilisation par des start-ups ou la culture sous garantie municipale."},
                {de: "Verkauf an B√ºrger-Syndikate zur Sicherung dauerhaft bezahlbarer Mieten.", en: "Sale to citizen syndicates to secure permanently affordable rents.", fr: "Vente √† des syndicats citoyens pour garantir des loyers abordables."}
            ];
            const desc = descMap[index][lang];

            // Update Content
            const container = document.getElementById('model-detail-content');
            container.innerHTML = `
                <div class="flex items-start gap-4 animate-fade-in">
                    <div class="text-4xl bg-white p-3 rounded-full shadow-sm">${m.icon}</div>
                    <div>
                        <h4 class="text-xl font-bold text-blue-800 mb-1">${title}</h4>
                        <div class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mb-3 font-semibold">Zielgruppe: ${sub}</div>
                        <p class="text-slate-700 leading-relaxed">${desc}</p>
                    </div>
                </div>
            `;

            // Update Chart
            if (modelsChartInstance) {
                modelsChartInstance.data.datasets[0].data = m.stats;
                modelsChartInstance.update();
            }
            sendHeight();
        }

        // --- PHASE D LOGIC ---
        function checkProportionality() {
            const leg = document.getElementById('check-legal').checked;
            const fin = document.getElementById('check-financial').checked;
            const res = document.getElementById('prop-result');
            const ladder = document.getElementById('escalation-container');
            const backBtn = document.getElementById('back-to-coop');

            const t = translations[currentLang];

            if (leg && fin) {
                res.className = "p-3 rounded font-bold text-center bg-red-100 text-red-700 transition-colors";
                res.innerHTML = t.res_ok;
                ladder.classList.remove('opacity-50', 'pointer-events-none');
                ladder.classList.add('opacity-100');
                backBtn.classList.add('hidden');
            } else {
                res.className = "p-3 rounded font-bold text-center bg-amber-100 text-amber-700 transition-colors";
                res.innerHTML = t.res_no;
                ladder.classList.add('opacity-50', 'pointer-events-none');
                backBtn.classList.remove('hidden');
            }
            sendHeight();
        }

        function setEscalation(level) {
            // Visual Update
            document.querySelectorAll('.escalation-step').forEach((el, idx) => {
                if (idx + 1 === level) {
                    el.classList.add('active', 'bg-red-50', 'border-red-600');
                } else {
                    el.classList.remove('active', 'bg-red-50', 'border-red-600');
                }
            });

            // Outcome Text
            const outBox = document.getElementById('escalation-outcome');
            outBox.classList.remove('hidden');
            let text = "";
            let outcomeClass = "";
            const t = translations[currentLang];
            
            if (level < 3) {
                text = t.outcome_low;
                outcomeClass = "bg-blue-50 border-blue-200 text-blue-800";
            } else if (level === 4) {
                text = t.outcome_high;
                outcomeClass = "bg-slate-800 border-slate-900 text-white";
            } else {
                 text = t.outcome_mid;
                 outcomeClass = "bg-amber-50 border-amber-200 text-amber-800";
            }
            outBox.innerHTML = text;
            outBox.className = `mt-4 p-3 rounded border text-center transition-all ${outcomeClass}`;
            sendHeight();
        }

        // Iframe Resize Logic
        function sendHeight() {
            const height = document.body.scrollHeight;
            window.parent.postMessage({ type: 'resize-iframe', height: height }, '*');
        }
        
        // Observers for height changes
        const resizeObserver = new ResizeObserver(() => sendHeight());
        resizeObserver.observe(document.body);

    </script>
</body>
</html>
